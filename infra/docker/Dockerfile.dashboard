FROM node:22-alpine

WORKDIR /app

# Install pnpm and build tools for native modules
RUN corepack enable && corepack prepare pnpm@8.14.0 --activate
RUN apk add --no-cache python3 py3-setuptools make g++ && ln -sf /usr/bin/python3 /usr/bin/python

# Copy all files
COPY . .

# Install dependencies
RUN pnpm install

ENV NODE_ENV=production
ENV PORT=3001

EXPOSE 3001

# Run Next.js dev server
WORKDIR /app/apps/dashboard
CMD ["pnpm", "dev"]
